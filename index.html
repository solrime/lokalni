<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <!-- Komponent pozwalający obiektowi patrzeć na kamerę -->
    <script src="https://unpkg.com/aframe-look-at-component@1.0.0/dist/aframe-look-at-component.min.js"></script>

    <script>
      AFRAME.registerShader('portal', {
        schema: {
          color: { type: 'color', default: '#FFF' },
          timeMsec: { type: 'time', is: 'uniform' }
        },
        vertexShader: `
          varying vec2 vUv;
          void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
          }
        `,
        fragmentShader: `
          uniform float timeMsec;
          varying vec2 vUv;
          void main() {
            float time = timeMsec / 1000.0;
            vec2 uv = vUv * 2.0 - 1.0;
            float radius = length(uv);
            float angle = atan(uv.y, uv.x);
            float distort = sin(angle * 5.0 + time * 2.0) * 0.1;
            uv += distort;
            vec3 color = vec3(sin(uv.x * 10.0 + time), cos(uv.y * 10.0 + time), sin(uv.x * uv.y * 10.0 + time));
            gl_FragColor = vec4(color, 1.0);
          }
        `
      });

      // System do zarządzania losowym patrzeniem oczu
      AFRAME.registerSystem('eye-manager', {
        init: function() {
          this.eyes = [];
          this.lookingEyes = [];
          this.timer = null;
          
          // Rozpocznij losowanie po załadowaniu sceny
          this.sceneEl.addEventListener('loaded', () => {
            this.startRandomizing();
          });
        },
        
        registerEye: function(eyeEl) {
          this.eyes.push(eyeEl);
        },
        
        startRandomizing: function() {
          const self = this;
          
          function randomizeLookingEyes() {
            // Reset wszystkie oczy - przestają patrzeć na kamerę
            self.eyes.forEach(eye => {
              eye.removeAttribute('look-at');
            });
            
            // Losowo wybierz które oczy będą patrzeć na kamerę
            self.lookingEyes = [];
            const numberOfLookingEyes = Math.floor(Math.random() * (self.eyes.length - 3)) + 3; // Co najmniej 3 oczy patrzą
            
            while (self.lookingEyes.length < numberOfLookingEyes) {
              const randomIndex = Math.floor(Math.random() * self.eyes.length);
              const randomEye = self.eyes[randomIndex];
              
              if (!self.lookingEyes.includes(randomEye)) {
                self.lookingEyes.push(randomEye);
                randomEye.setAttribute('look-at', '[camera]');
              }
            }
            
            // Uruchom ponownie timer
            self.timer = setTimeout(randomizeLookingEyes, 5000);
          }
          
          // Pierwsze losowanie
          randomizeLookingEyes();
        },
        
        stopRandomizing: function() {
          if (this.timer) {
            clearTimeout(this.timer);
          }
        }
      });

      // Komponent dla pojedynczego oka
      AFRAME.registerComponent('random-eye', {
        init: function() {
          this.system = this.el.sceneEl.systems['eye-manager'];
          this.system.registerEye(this.el);
        }
      });
    </script>
  </head>

  <body>
    <a-scene embedded arjs="patternRatio: 0.80" eye-manager>
      <a-marker type="pattern" url="https://raw.githubusercontent.com/solrime/lokalni/refs/heads/main/pattern-adobe-express-qr-code%20(13).patt">

        <!-- Główna rzeźba (oko) - zawsze patrzy na kamerę -->
        <a-entity
          gltf-model="url(https://cdn.tinyglb.com/models/35282dbf5d3f49878a1f49979bc1b64c.glb)"
          position="0 0 0"
          scale="0.2 0.2 0.2"
          rotation="0 0 0"
          material="opacity: 0; transparent: true"
          look-at="[camera]"
        ></a-entity>

        <!-- Mniejsze oczy rozmieszczone równomiernie wokół głównego oka -->
        <!-- Oczy na płaszczyźnie XZ (poziomej) -->
        <a-entity
          gltf-model="url(https://cdn.tinyglb.com/models/35282dbf5d3f49878a1f49979bc1b64c.glb)"
          position="0.7 0 0"
          scale="0.1 0.1 0.1"
          rotation="0 0 0"
          material="opacity: 0; transparent: true"
          random-eye
          animation="property: rotation; to: 360 360 360; loop: true; dur: 8000; easing: linear"
          animation__3="property: position; to: 0.7 0.2 0; loop: true; dur: 3000; dir: alternate; easing: easeInOutSine"
        ></a-entity>

        <a-entity
          gltf-model="url(https://cdn.tinyglb.com/models/35282dbf5d3f49878a1f49979bc1b64c.glb)"
          position="-0.7 0 0"
          scale="0.1 0.1 0.1"
          rotation="0 0 0"
          material="opacity: 0; transparent: true"
          random-eye
          animation="property: rotation; to: -360 -360 -360; loop: true; dur: 8000; easing: linear"
          animation__3="property: position; to: -0.7 0.2 0; loop: true; dur: 3000; dir: alternate; easing: easeInOutSine"
        ></a-entity>

        <a-entity
          gltf-model="url(https://cdn.tinyglb.com/models/35282dbf5d3f49878a1f49979bc1b64c.glb)"
          position="0 0 0.7"
          scale="0.1 0.1 0.1"
          rotation="0 0 0"
          material="opacity: 0; transparent: true"
          random-eye
          animation="property: rotation; to: 360 360 360; loop: true; dur: 8000; easing: linear"
          animation__3="property: position; to: 0 0.2 0.7; loop: true; dur: 3000; dir: alternate; easing: easeInOutSine"
        ></a-entity>

        <a-entity
          gltf-model="url(https://cdn.tinyglb.com/models/35282dbf5d3f49878a1f49979bc1b64c.glb)"
          position="0 0 -0.7"
          scale="0.1 0.1 0.1"
          rotation="0 0 0"
          material="opacity: 0; transparent: true"
          random-eye
          animation="property: rotation; to: -360 -360 -360; loop: true; dur: 8000; easing: linear"
          animation__3="property: position; to: 0 0.2 -0.7; loop: true; dur: 3000; dir: alternate; easing: easeInOutSine"
        ></a-entity>

        <!-- Oczy na płaszczyźnie XY (pionowej) -->
        <a-entity
          gltf-model="url(https://cdn.tinyglb.com/models/35282dbf5d3f49878a1f49979bc1b64c.glb)"
          position="0 0.7 0"
          scale="0.1 0.1 0.1"
          rotation="0 0 0"
          material="opacity: 0; transparent: true"
          random-eye
          animation="property: rotation; to: 360 360 360; loop: true; dur: 8000; easing: linear"
          animation__3="property: position; to: 0.2 0.7 0; loop: true; dur: 3000; dir: alternate; easing: easeInOutSine"
        ></a-entity>

        <a-entity
          gltf-model="url(https://cdn.tinyglb.com/models/35282dbf5d3f49878a1f49979bc1b64c.glb)"
          position="0 -0.7 0"
          scale="0.1 0.1 0.1"
          rotation="0 0 0"
          material="opacity: 0; transparent: true"
          random-eye
          animation="property: rotation; to: -360 -360 -360; loop: true; dur: 8000; easing: linear"
          animation__3="property: position; to: 0.2 -0.7 0; loop: true; dur: 3000; dir: alternate; easing: easeInOutSine"
        ></a-entity>

        <!-- Oczy na przekątnych -->
        <a-entity
          gltf-model="url(https://cdn.tinyglb.com/models/35282dbf5d3f49878a1f49979bc1b64c.glb)"
          position="0.5 0.5 0"
          scale="0.1 0.1 0.1"
          rotation="0 0 0"
          material="opacity: 0; transparent: true"
          random-eye
          animation="property: rotation; to: 360 360 360; loop: true; dur: 8000; easing: linear"
          animation__3="property: position; to: 0.5 0.5 0.2; loop: true; dur: 3000; dir: alternate; easing: easeInOutSine"
        ></a-entity>

        <a-entity
          gltf-model="url(https://cdn.tinyglb.com/models/35282dbf5d3f49878a1f49979bc1b64c.glb)"
          position="-0.5 0.5 0"
          scale="0.1 0.1 0.1"
          rotation="0 0 0"
          material="opacity: 0; transparent: true"
          random-eye
          animation="property: rotation; to: -360 -360 -360; loop: true; dur: 8000; easing: linear"
          animation__3="property: position; to: -0.5 0.5 0.2; loop: true; dur: 3000; dir: alternate; easing: easeInOutSine"
        ></a-entity>

        <a-entity
          gltf-model="url(https://cdn.tinyglb.com/models/35282dbf5d3f49878a1f49979bc1b64c.glb)"
          position="0.5 -0.5 0"
          scale="0.1 0.1 0.1"
          rotation="0 0 0"
          material="opacity: 0; transparent: true"
          random-eye
          animation="property: rotation; to: 360 360 360; loop: true; dur: 8000; easing: linear"
          animation__3="property: position; to: 0.5 -0.5 0.2; loop: true; dur: 3000; dir: alternate; easing: easeInOutSine"
        ></a-entity>

        <a-entity
          gltf-model="url(https://cdn.tinyglb.com/models/35282dbf5d3f49878a1f49979bc1b64c.glb)"
          position="-0.5 -0.5 0"
          scale="0.1 0.1 0.1"
          rotation="0 0 0"
          material="opacity: 0; transparent: true"
          random-eye
          animation="property: rotation; to: -360 -360 -360; loop: true; dur: 8000; easing: linear"
          animation__3="property: position; to: -0.5 -0.5 0.2; loop: true; dur: 3000; dir: alternate; easing: easeInOutSine"
        ></a-entity>

      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>